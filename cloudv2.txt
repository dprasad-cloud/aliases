#Run the below line on AIO to get the aliases installed. Remove # before executing
# sudo yum install unzip # if unzip is not installed
# file=cloudv2.txt ; wget -O /root/main.zip https://github.com/dprasad-cloud/aliases/archive/refs/heads/main.zip ; unzip -o /root/main.zip -d /root; source /root/aliases-main/$file;

alias findpod='kubectl get pods -A | grep '
alias findsvc='kubectl get svc -A | grep '
alias finding='kubectl get ing -A | grep '

chmod +x /root/aliases-main/desc.sh
alias desc='/root/aliases-main/desc.sh'

chmod +x /root/aliases-main/configmap.sh
alias cm='/root/aliases-main/configmap.sh'

chmod +x /root/aliases-main/logs.sh
alias logs='/root/aliases-main/logs.sh'

chmod +x /root/aliases-main/logsf.sh
alias logsf='/root/aliases-main/logsf.sh'

chmod +x /root/aliases-main/podbash.sh
alias podbash='/root/aliases-main/podbash.sh'

chmod +x /root/aliases-main/podsh.sh
alias podsh='/root/aliases-main/podsh.sh'

chmod +x /root/aliases-main/podexec.sh
alias podexec='/root/aliases-main/podexec.sh'

chmod +x /root/aliases-main/kedit.sh
alias kedit='/root/aliases-main/kedit.sh'

hmvi () {
  podexec "$1" vi /opt/tomcat/logs/hm.log
}
hmcat () {
  podexec "$1" cat /opt/tomcat/logs/hm.log
}
hmtail () {
  podexec "$1" tail -f /opt/tomcat/logs/hm.log
}

loop () { while true; do date; eval $@; echo -e '\n'; sleep 15;  done;}

ups () {
    # Define the target file name inside the extracted directory
    local file="cloudv2.txt"

    # 1. Download the repository archive and save it to /root/main.zip
    wget -O /root/main.zip https://github.com/dprasad-cloud/aliases/archive/refs/heads/main.zip

    # 2. Unzip the archive to /root, overwriting existing files (-o)
    unzip -o /root/main.zip -d /root

    # 3. Source the specific file (cloudv2.txt) from the extracted folder (aliases-main)
    # This executes the commands/aliases defined in cloudv2.txt in the current shell session.
    source /root/aliases-main/$file
}

findcm() {
    # 1. Capture the search term provided as the first argument ($1)
    local SEARCH_TERM="$1"

    # 2. Process the search term to strip common suffixes (if $1 is not empty)
    if [ -n "$SEARCH_TERM" ]; then
        # The sed pipeline strips:
        # -[a-z0-9]{5}$  (e.g., -abcde, common Helm/Kustomize hashes)
        # -[a-f0-9]{9,10}$ (e.g., -abcdef0123, longer hashes)
        # -[0-9]+$ (e.g., -12345, revision numbers)
        SEARCH_TERM=$(echo "$SEARCH_TERM" | sed -E 's/-[a-z0-9]{5}$//' | sed -E 's/-[a-f0-9]{9,10}$//' | sed -E 's/-[0-9]+$//')
    fi

    # 3. Execute the kubectl command with the stripped search term
    # Note: We use the processed $SEARCH_TERM in the grep command.
    kubectl get cm -A | grep -i "$SEARCH_TERM"
}

clear;

echo -e "\n Available Shortcuts - Feel free to use flags like -i as in grep command: findpod -i error"
echo -e "\n "
echo -e "\t findpod <search_key>        : Find pod across all namespaces"
echo -e "\t findsvc <search_key>        : Find service across all namespaces"
echo -e "\t finding <search_key>        : Find ingress across all namespaces"
echo -e "\t findcm <search_key>         : Find configmap across all namespaces"
echo -e "\n "
echo -e "\t desc <search_key>          : Find the pod across all namespaces and get description"
echo -e "\t cm <search_key>            : Find the configmap across all namespaces and get properties"
echo -e "\n "
echo -e "\t logs <search_key>          : Find the pod across all namespaces and get logs"
echo -e "\t logsf <search_key>         : Find the pod across all namespaces and follow logs"
echo -e "\n "
echo -e "\t podbash <search_key>       : Find the pod across all namespaces and bash into the pod"
echo -e "\t podsh <search_key>         : Find the pod across all namespaces and sh into the pod"
echo -e "\t podexec <search_key> <cmd> : Find the pod across all namespaces and run the cmd"
echo -e "\t kedit <search_key>         : Find the pod across all namespaces and run the kubectl edit deployment..."
echo -e "\n "
echo -e "\t hmvi <search_key>       : Find the pod across all namespaces and run command vi /opt/tomcat/logs/hm.log"
echo -e "\t hmcat <search_key>      : Find the pod across all namespaces and run command cat /opt/tomcat/logs/hm.log"
echo -e "\t hmtail <search_key>     : Find the pod across all namespaces and run command tail -f /opt/tomcat/logs/hm.log"
echo -e "\n "
echo -e "\t loop <command>          : loop the provided command every 15 seconds"
echo -e "\t ups                     : Update the aliases to latest version from github, also show this help"
echo -e "\n "
echo -e "Send shortcut suggestions and feedback to dprasad@extremenetworks.com"
echo -e "\n "


